<mat-card class="button">
    <a mat-raised-button color="accent" routerLink="/pedidos" >Listado de pedidos</a>
</mat-card>

<ng-container>
    <form
    class="needs-validation"
    novalidate
    [formGroup]="headForm"
    (ngSubmit)="onSubmitHead()">
        <mat-card>
            <mat-card-content>
                <section>
                    <mat-form-field class="inputSmall" appearance="fill"  >
                        <mat-label>Serie</mat-label>
                        <mat-select formControlName="Serie" placeholder="Selecciona una serie" [(value)]="selectedSerie">
                          <mat-option *ngFor="let item of serie" [value]="item.value">
                            {{item.viewValue}}
                          </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="inputBig" *ngIf = "customer" appearance="fill"  >
                        <mat-label>Cliente</mat-label>
                        <mat-select formControlName="CodCli" (selectionChange)="onChangeCustomer($event)" placeholder="Selecciona un cliente" [(value)]="selectedCodCli">
                          <mat-option *ngFor="let item of customer" [value]="item.IdCliente">
                            {{item.Nombre}}
                          </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <mat-form-field class="inputSmall" appearance="fill">
                        <mat-label>Dto. pronto pago</mat-label>
                        <input matInput
                          formControlName="DtoPP" type="number" min=0 max=100 step=0.01 ng-readonly="true">
                    </mat-form-field>

                    <mat-form-field class="inputMedium" *ngIf = "payments$" appearance="fill"  >
                        <mat-label>Forma de pago</mat-label>
                        <mat-select formControlName="CodFormaPago" placeholder="Selecciona una forma de pago" [(value)]="selectedPayment">
                          <mat-option *ngFor="let pay of payments$ | async" [value]="pay.IdFormaPago">
                            {{pay.Nombre}}
                          </mat-option>
                        </mat-select>
                    </mat-form-field>
                </section>
            </mat-card-content>
        </mat-card>
    </form>
</ng-container>
<ng-container class="articulos" *ngIf="selectedCodCli">
  <mat-card>
      <mat-card-header>
          <mat-card-header>Seleccione un atículo y pulse añadir.</mat-card-header>
          <br>
         <!-- <mat-card-subtitle></mat-card-subtitle>-->
      </mat-card-header>
    <!--    <img matCardImage src="Card wide image source"> -->
      <mat-card-content>
          <form
          class="needs-validation"
          novalidate
          [formGroup]="artForm">
        <mat-form-field class="inputMedium" *ngIf = "product" appearance="fill">
            <mat-label>Artículo</mat-label>
            <mat-select formControlName="CodArt" (selectionChange)="onChangeArt($event)" placeholder="Selecciona un artículo" [(value)]="selectedCodArt">
              <mat-option *ngFor="let art of product" [value]="art.ID">
                {{art.ID}}
              </mat-option>
            </mat-select>
        </mat-form-field>

          <mat-form-field class="inputBig" hintLabel="Max. 150 caracteres" appearance="fill">
            <mat-label>Descripcion</mat-label>
            <input formControlName="Descripcion" matInput #input1 maxlength="150" [ngClass]="{'is-invalid': isValidFieldArt('Descripcion')}">
            <mat-hint align="end">{{input1.value?.length || 0}}/150</mat-hint>
            <div class="invalid-feedback">
              <span class="span-errors" *ngIf="artForm.get('Descripcion').errors?.required">
                  El nombre es obligatorio.
              </span>
              <span class="span-errors" *ngIf="artForm.get('Descripcion').errors?.minlength">
                Longitud mínima es de
                {{ customersForm.get("Url").errors?.minlength?.requiredLength }}
                caracteres.
              </span>
              <span class="span-errors" *ngIf="artForm.get('Descripcion').errors?.pattern">
                Caracteres no válidos.
              </span>
            </div>
          </mat-form-field>
          <mat-form-field class="inputSmall" appearance="fill">
            <mat-label>Cantidad</mat-label>
            <input formControlName="Cantidad" matInput [ngClass]="{'is-invalid': isValidFieldArt('Cantidad')}">
            <div class="invalid-feedback">
              <span class="span-errors" *ngIf="artForm.get('Cantidad').errors?.required">
                El nombre es obligatorio.
              </span>
              <span class="span-errors" *ngIf="artForm.get('Cantidad').errors?.pattern">
                Caracteres no válidos.
              </span>
            </div>
          </mat-form-field>
          <mat-form-field class="inputSmall" appearance="fill">
            <mat-label>Precio</mat-label>
            <input formControlName="Precio" matInput [ngClass]="{'is-invalid': isValidFieldArt('Precio')}">
            <div class="invalid-feedback">
              <span class="span-errors" *ngIf="artForm.get('Precio').errors?.required">
                El nombre es obligatorio.
              </span>
              <span class="span-errors" *ngIf="artForm.get('Precio').errors?.pattern">
                Caracteres no válidos.
              </span>
            </div>
          </mat-form-field>
          <mat-form-field class="inputSmall" appearance="fill">
            <mat-label>Dto. comercial</mat-label>
            <input matInput
              formControlName="DtoComercial"
              type="number"
              min=0 max=100 step=0.01
              [ngClass]="{'is-invalid': isValidFieldArt('DtoComercial')}"
              [(value)]="selectedDtoComercial"
              >
              <div class="invalid-feedback">
                <span class="span-errors" *ngIf="artForm.get('DtoComercial').errors?.required">
                  Dto. comercial es obligatorio.
                </span>
                <span class="span-errors" *ngIf="artForm.get('DtoComercial').errors?.pattern">
                  Caracteres no válidos.
                </span>
                <span class="span-errors" *ngIf="artForm.get('DtoComercial').errors?.min">
                  Valor mínimo permitido 0.
                </span>
                <span class="span-errors" *ngIf="artForm.get('DtoComercial').errors?.max">
                  Valor máximo permitido 100.
                </span>
              </div>
          </mat-form-field>
          <button mat-button color="primary" (click)="onAddArt()">Añadir</button>
        </form>
      </mat-card-content>
  <!--    <mat-card-actions align="medium">

      </mat-card-actions>-->
      <mat-card-footer>
        <p>Linea añadida</p>
      </mat-card-footer>
  </mat-card>
</ng-container>

<mat-form-field >
  <mat-label>Búsqueda</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="Dígite el texto a buscar" #input>
</mat-form-field>

<div class="mat-elevation-z8">
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

    <ng-container matColumnDef="Imagen">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Imagen </th>
      <td mat-cell *matCellDef="let element">
        <img src={{element.Imagen}}  style="max-width:100%;width:auto;height:auto;"/>
      </td>
    </ng-container>

    <ng-container matColumnDef="Articulo">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Artículo </th>
      <td mat-cell *matCellDef="let element"> {{element.Articulo}} </td>
    </ng-container>

    <ng-container matColumnDef="Sku">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> SKU </th>
      <td mat-cell *matCellDef="let element"> {{element.Sku}} </td>
    </ng-container>

    <ng-container matColumnDef="precio">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Precio </th>
      <td mat-cell *matCellDef="let element"> {{element.precio}} </td>
    </ng-container>

    <ng-container matColumnDef="PrecioRebajado">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Precio Rebajado </th>
      <td mat-cell *matCellDef="let element"> {{element.PrecioRebajado}} </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Acciones</th>
      <td mat-cell *matCellDef="let element">
        <div class="table-button-row">
         <!-- <a mat-flat-button color="primary" routerLink="/products/Form" [queryParams]="{Id: element.ID}">Editar</a>-->

          <button mat-button color="primary" (click)="onSelectArt(element)">Seleccionar</button>
         </div>

      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[3, 5]" showFirstLastButtons></mat-paginator>
</div>
